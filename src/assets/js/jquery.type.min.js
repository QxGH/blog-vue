(function(window,$){function WordBox(wrapper,options){var defaults={isLead:false,leadWord:null,words:null,colors:["#cc5b34","#c27c4d"],isFixedWidth:true,width:1000,height:200};this.options=$.extend(false,defaults,options);this.$wrapper=$(wrapper);if(!this.$wrapper||this.options.words.length<1){return false}this._create();this._bindListener();return this}WordBox.prototype={words:[],colors:[],colorPos:0,_create:function(){if(this.options.isLead&&this.options.leadWord){this.words=[this.options.leadWord].concat(this._randArray(this.options.words))}else{this.words=this._randArray(this.options.words)}if(this.options.isFixedWidth){this.$wrapper.width(this.options.width);this.$wrapper.height(this.options.height)}else{this.$wrapper.width(this.$wrapper.parent().width());this.$wrapper.height(this.$wrapper.parent().height())}this.fillRect(this.$wrapper,0,0,this.$wrapper.width(),this.$wrapper.height(),this.words)},fillRect:function(wrapper,left,top,width,height,words){var wordLen=words.length,ratio=width/height,dot=this._randRange(1,2,0.5),wordLen1=Math.round(wordLen*dot[0]),wordLen2=wordLen-wordLen1;if(wordLen==1){this._createBox(wrapper,left,top,width,height,words[0],this._getNextColor());return}if(wordLen1==0){wordLen1=1;wordLen2--}else{if(wordLen2==0){wordLen2=1;wordLen1--}}if(ratio>=2.5){var leftW=Math.round(width*dot[0]),rightW=width-leftW;this.fillRect(wrapper,left,top,leftW,height,words.slice(0,wordLen1));this.fillRect(wrapper,left+leftW,top,rightW,height,words.slice(wordLen1))}else{var topH=Math.round(height*dot[0]),bottomH=height-topH;this.fillRect(wrapper,left,top,width,topH,words.slice(0,wordLen1));this.fillRect(wrapper,left,top+topH,width,height-topH,words.slice(wordLen1))}},_createBox:function(wrapper,left,top,width,height,word,color){var lineHeight=height,paddingTop=0,wordW=this._getWordsWidth(word.title);if(wordW>width){var line=Math.ceil(wordW/width);lineHeight=parseInt(this.$wrapper.css("font-size"));paddingTop=Math.max(0,(height-line*lineHeight)/2);height-=paddingTop}var html='<div class="box" style="width:'+width+"px;"+"height:"+height+"px;"+"line-height:"+lineHeight+"px;"+"top:"+top+"px;"+"left:"+left+"px;"+"background-color:"+color+";"+(paddingTop?("padding-top:"+paddingTop+"px;"):"")+'">'+'<a href="'+word.url+'" >'+word.title+"</a></div>";$(wrapper).append(html)},_randRange:function(base,num,round){var center=base/num,min=center*(1-round),max=center*(1+round),rand=Math.random()*(max-min)+min;if(num==1){return[base]}return[rand].concat(this._randRange(base-rand,num-1,round))},_getNextColor:function(){var color=this.options.colors[this.colorPos%this.options.colors.length];this.colorPos++;return color},_getWordsWidth:function(word){if($("#get_ww").length<1){$('<div id="get_ww" style="display:none;visibility:hidden;font-size:'+this.$wrapper.css("font-size")+'px"><span></span></div>').appendTo("body")}$("#get_ww span").html(word);return $("#get_ww span").width()},_randArray:function(array){var clone=array.slice(),ret=[],rand;for(var i=0,len=array.length;i<len;i++){rand=Math.floor(Math.random()*clone.length);var tmp=clone[0];clone[0]=clone[rand];clone[rand]=tmp;ret.push(clone[0]);clone=clone.slice(1)}return ret},_bindListener:function(){if(!this.options.isFixedWidth){var _this=this,timer=null;$(window).bind("resize",function(){if(timer){clearTimeout(window.timer);timer=null}timer=setTimeout(function(){if(_this.$wrapper.width()!=_this.$wrapper.parent().width()||_this.$wrapper.height()!=_this.$wrapper.parent().height()){_this.$wrapper.width(_this.$wrapper.parent().width());_this.$wrapper.height(_this.$wrapper.parent().height());_this.$wrapper.empty();_this.fillRect(_this.$wrapper,0,0,_this.$wrapper.width(),_this.$wrapper.height(),_this.words)}},800)})}}};window.WordBox=WordBox;$.fn.wordbox=function(options){var instance=new WordBox(this,options);if(!instance){console.log("创建失败");return null}return $(this)}})(window,jQuery);